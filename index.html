<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>2025 投资实盘监控 | LIANG JIAHAO</title>
    
    <!-- 1. Styles & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', 'Noto Sans SC', 'Inter', sans-serif;
            background-color: #f3f4f6;
            -webkit-font-smoothing: antialiased;
            overscroll-behavior-y: none; /* Prevent rubber-banding on mobile */
        }
        /* Hide scrollbar for mobile tables */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Spin Animation */
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        
        /* Pulse Animation */
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>

    <!-- 2. React & Babel (No Build Step Required) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="root"></div>

    <!-- 3. Application Logic -->
    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- Constants & Data ---
        const CASH_POOL_CNY = 3000.00;
        const DEFAULT_EXCHANGE_RATE = 7.25;
        const REFRESH_INTERVAL_MS = 10000;
        const DEFAULT_FINNHUB_KEY = 'd4jul8pr01qgcb0vme30d4jul8pr01qgcb0vme3g';

        const INITIAL_PORTFOLIO = [
            // US Stocks
            { market: 'us', code: 'QQQM', name: '纳指100', shares: 1, cost: 241.580 },
            { market: 'us', code: 'SPYM', name: '标普500', shares: 1, cost: 78.670 },
            { market: 'us', code: 'GLDM', name: '黄金', shares: 1, cost: 81.840 },
            { market: 'us', code: 'SCHD', name: '红利ETF', shares: 3, cost: 27.110 },
            // CN Stocks
            { market: 'cn', code: 'sh601328', name: '交通银行', shares: 100, cost: 7.670 },
            { market: 'cn', code: 'sh601988', name: '中国银行', shares: 100, cost: 6.210 },
            { market: 'cn', code: 'sh601728', name: '中国电信', shares: 100, cost: 6.860 }
        ];

        // --- Icons (Inline SVGs to avoid dependencies) ---
        const Icons = {
            Settings: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.35a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            RefreshCw: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 21H3v-5"/></svg>,
            Activity: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>,
            Globe: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>,
            DollarSign: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
            TrendingUp: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
            X: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Save: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/><path d="M17 21v-8H7v8"/><path d="M7 3v5h8"/></svg>,
            Key: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="7.5" cy="15.5" r="5.5"/><path d="m21 2-9.6 9.6"/><path d="m15.5 7.5 3 3L22 7l-3-3"/></svg>
        };

        // --- Utilities ---
        const utils = {
            getTrendClass: (value, type = 'text') => {
                if (value > 0) return type === 'text' ? 'text-red-500' : 'bg-red-500 text-white';
                if (value < 0) return type === 'text' ? 'text-emerald-500' : 'bg-emerald-500 text-white';
                return type === 'text' ? 'text-gray-400' : 'bg-gray-100 text-gray-500';
            },
            formatCurrency: (val, currency) => {
                return `${currency}${val.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            },
            formatPercent: (val) => {
                const sign = val > 0 ? '+' : '';
                return `${sign}${val.toFixed(2)}%`;
            },
            checkMarketOpen: () => {
                const now = new Date();
                const day = now.getDay();
                const isWeekend = (day === 0 || day === 6);
                
                // CN: 9:15-15:05 UTC+8
                const hour = now.getHours();
                const minute = now.getMinutes();
                const timeVal = hour * 100 + minute;
                let isCNOpen = !isWeekend && (timeVal >= 915 && timeVal <= 1505);
                if (timeVal > 1135 && timeVal < 1255) isCNOpen = false;

                // US: Mon-Fri 04:00-20:00 ET (Simplified)
                const nyTimeStr = now.toLocaleString("en-US", { timeZone: "America/New_York" });
                const nyDate = new Date(nyTimeStr);
                const nyDay = nyDate.getDay();
                const nyHour = nyDate.getHours();
                const isUSOpen = (nyDay !== 0 && nyDay !== 6) && (nyHour >= 4 && nyHour < 20);

                return { cn: isCNOpen, us: isUSOpen };
            }
        };

        // --- Services ---
        const services = {
            fetchCNStocks: (items) => {
                return new Promise((resolve) => {
                    const cnItems = items.filter(i => i.market === 'cn');
                    if (cnItems.length === 0) return resolve(new Map());

                    const codes = cnItems.map(p => p.code).join(',');
                    const script = document.createElement('script');
                    script.src = `https://qt.gtimg.cn/q=${codes}`;
                    
                    script.onload = () => {
                        const priceMap = new Map();
                        cnItems.forEach(p => {
                            try {
                                const varName = `v_${p.code}`;
                                if (window[varName]) {
                                    const parts = window[varName].split('~');
                                    const current = parseFloat(parts[3]);
                                    if (!isNaN(current) && current > 0) priceMap.set(p.code, current);
                                }
                            } catch (e) {}
                        });
                        document.body.removeChild(script);
                        resolve(priceMap);
                    };
                    script.onerror = () => resolve(new Map());
                    document.body.appendChild(script);
                });
            },
            fetchUSStocks: async (items, apiKey) => {
                if (!apiKey) return new Map();
                const usItems = items.filter(i => i.market === 'us');
                const priceMap = new Map();
                
                await Promise.all(usItems.map(async (item) => {
                    try {
                        const res = await fetch(`https://finnhub.io/api/v1/quote?symbol=${item.code}&token=${apiKey}`);
                        const data = await res.json();
                        if (data.c) priceMap.set(item.code, data.c);
                    } catch (e) {
                        console.warn(`Failed US stock ${item.code}`, e);
                    }
                }));
                return priceMap;
            },
            fetchExchangeRate: async () => {
                try {
                    const res = await fetch('https://api.frankfurter.app/latest?from=USD&to=CNY');
                    const data = await res.json();
                    return data.rates.CNY || null;
                } catch (e) { return null; }
            }
        };

        // --- Components ---
        
        const SummaryCard = ({ title, mainValue, subValue, plValue, plText, isPrimary, extraInfo, icon }) => {
            const trendClass = utils.getTrendClass(plValue, isPrimary ? 'bg' : 'text');
            const CardWrapper = ({ children }) => isPrimary ? (
                <div className="relative overflow-hidden rounded-2xl bg-gray-900 p-6 text-white shadow-xl shadow-gray-900/10 transition-transform active:scale-[0.99]">
                    <div className="absolute top-0 right-0 -mt-4 -mr-4 w-32 h-32 bg-white/5 rounded-full blur-2xl"></div>
                    <div className="absolute bottom-0 left-0 -mb-4 -ml-4 w-32 h-32 bg-blue-500/10 rounded-full blur-2xl"></div>
                    {children}
                </div>
            ) : (
                <div className="relative overflow-hidden rounded-2xl bg-white p-6 shadow-sm ring-1 ring-gray-200/50 transition-all hover:shadow-md active:scale-[0.99]">
                    {children}
                </div>
            );

            return (
                <CardWrapper>
                    <div className="relative z-10 flex flex-col h-full justify-between">
                        <div className="flex justify-between items-start">
                            <div className="flex items-center gap-2">
                                <span className="text-gray-400">{icon}</span>
                                <h3 className={`text-xs font-bold uppercase tracking-wider ${isPrimary ? 'text-gray-400' : 'text-gray-500'}`}>{title}</h3>
                            </div>
                            <span className={`text-xs font-bold px-2 py-1 rounded-md ${isPrimary ? trendClass : (plValue >= 0 ? 'bg-red-50 text-red-600' : 'bg-emerald-50 text-emerald-600')}`}>
                                {plText}
                            </span>
                        </div>
                        <div className="mt-4">
                            <div className={`text-3xl font-bold tracking-tight ${isPrimary ? 'text-white' : 'text-gray-900'}`}>{mainValue}</div>
                            <div className={`text-xs mt-2 font-medium flex items-center gap-1 ${isPrimary ? 'text-gray-400' : 'text-gray-500'}`}>
                                <span>投入成本:</span><span className="font-mono">{subValue}</span>
                            </div>
                        </div>
                        {extraInfo && <div className={`mt-4 pt-4 border-t text-xs flex justify-between ${isPrimary ? 'border-gray-800 text-gray-500' : 'border-gray-100 text-gray-400'}`}>{extraInfo}</div>}
                    </div>
                </CardWrapper>
            );
        };

        const Header = ({ onOpenSettings, onRefresh, isRefreshing, marketStatus }) => {
            const [timeStr, setTimeStr] = useState('--:--:--');
            useEffect(() => {
                const t = setInterval(() => setTimeStr(new Date().toLocaleTimeString('zh-CN', { hour12: false })), 1000);
                return () => clearInterval(t);
            }, []);

            const StatusDot = ({ active, label }) => (
                <div className="flex items-center gap-1.5">
                    <span className="relative flex h-2.5 w-2.5">
                        {active && <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>}
                        <span className={`relative inline-flex rounded-full h-2.5 w-2.5 ${active ? 'bg-red-500' : 'bg-gray-300'}`}></span>
                    </span>
                    <span className="text-xs font-medium text-gray-500">{label}</span>
                </div>
            );

            return (
                <header className="sticky top-0 z-40 w-full backdrop-blur-lg bg-white/80 border-b border-gray-200/60 shadow-sm">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex justify-between items-center h-16">
                            <div className="flex items-center gap-3">
                                <div className="h-9 w-9 rounded-xl bg-gradient-to-br from-rose-500 to-orange-500 flex items-center justify-center text-white font-bold shadow-lg shadow-orange-500/20 text-lg">L</div>
                                <div className="flex flex-col">
                                    <h1 className="text-base font-bold text-gray-900 leading-none">LIANG 的实盘</h1>
                                    <div className="flex items-center gap-3 mt-1.5">
                                        <StatusDot active={marketStatus.cn} label="A股" />
                                        <StatusDot active={marketStatus.us} label="美股" />
                                    </div>
                                </div>
                            </div>
                            <div className="flex items-center gap-2 sm:gap-4">
                                <div className="hidden sm:block font-mono text-xs text-gray-400 font-medium tabular-nums bg-gray-50 px-2 py-1 rounded border border-gray-100">{timeStr}</div>
                                <button onClick={onOpenSettings} className="p-2 text-gray-400 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"><Icons.Settings className="w-5 h-5" /></button>
                                <button onClick={onRefresh} disabled={isRefreshing} className="flex items-center gap-2 bg-gray-900 hover:bg-black text-white px-3 py-1.5 rounded-lg text-sm font-medium shadow-md transition-all active:scale-95 disabled:opacity-70">
                                    <span className={isRefreshing ? 'animate-spin' : ''}><Icons.RefreshCw className="w-4 h-4" /></span>
                                    <span className="hidden sm:inline">刷新</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        const SettingsModal = ({ isOpen, onClose, currentKey, onSave }) => {
            const [key, setKey] = useState(currentKey);
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-fade-in">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden animate-slide-up">
                        <div className="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                            <h3 className="font-semibold text-gray-900">系统设置</h3>
                            <button onClick={onClose} className="text-gray-400 hover:text-gray-600"><Icons.X className="w-5 h-5" /></button>
                        </div>
                        <div className="p-6 space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1 flex items-center gap-2"><Icons.Key className="w-4 h-4 text-gray-400" /> Finnhub API Key</label>
                                <input type="text" value={key} onChange={(e) => setKey(e.target.value)} className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500/20 focus:border-red-500 text-sm font-mono text-gray-600" />
                            </div>
                        </div>
                        <div className="px-6 py-4 bg-gray-50 flex justify-end">
                            <button onClick={() => { onSave(key); onClose(); }} className="flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium shadow-sm transition-colors"><Icons.Save className="w-4 h-4" /> 保存设置</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App ---
        const App = () => {
            const [finnhubKey, setFinnhubKey] = useState(() => localStorage.getItem('finnhubKey') || DEFAULT_FINNHUB_KEY);
            const [exchangeRate, setExchangeRate] = useState(DEFAULT_EXCHANGE_RATE);
            const [stocks, setStocks] = useState(() => INITIAL_PORTFOLIO.map(p => ({ ...p, currentPrice: p.cost, marketValue: p.cost * p.shares, pl: 0, plPercent: 0 })));
            const [isRefreshing, setIsRefreshing] = useState(false);
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [lastUpdated, setLastUpdated] = useState(new Date());
            const [marketStatus, setMarketStatus] = useState({ cn: false, us: false });

            useEffect(() => {
                const updateStatus = () => setMarketStatus(utils.checkMarketOpen());
                updateStatus();
                const t = setInterval(updateStatus, 60000);
                return () => clearInterval(t);
            }, []);

            const fetchData = useCallback(async (force = false) => {
                setIsRefreshing(true);
                const { cn, us } = utils.checkMarketOpen();
                const shouldFetchCN = force || cn;
                const shouldFetchUS = force || us;

                try {
                    const [cnPrices, usPrices, rate] = await Promise.all([
                        shouldFetchCN ? services.fetchCNStocks(INITIAL_PORTFOLIO) : Promise.resolve(new Map()),
                        shouldFetchUS ? services.fetchUSStocks(INITIAL_PORTFOLIO, finnhubKey) : Promise.resolve(new Map()),
                        (force || cn || us) ? services.fetchExchangeRate() : Promise.resolve(null)
                    ]);

                    if (rate) setExchangeRate(rate);

                    setStocks(prev => prev.map(stock => {
                        let newPrice = stock.currentPrice;
                        if (stock.market === 'cn' && cnPrices.has(stock.code)) newPrice = cnPrices.get(stock.code);
                        else if (stock.market === 'us' && usPrices.has(stock.code)) newPrice = usPrices.get(stock.code);

                        const marketValue = newPrice * stock.shares;
                        const costValue = stock.cost * stock.shares;
                        const pl = marketValue - costValue;
                        const plPercent = costValue !== 0 ? (pl / costValue) * 100 : 0;
                        return { ...stock, currentPrice: newPrice, marketValue, pl, plPercent };
                    }));
                    setLastUpdated(new Date());
                } catch (e) { console.error(e); } 
                finally { setIsRefreshing(false); }
            }, [finnhubKey]);

            useEffect(() => {
                fetchData(true);
                const i = setInterval(() => fetchData(false), REFRESH_INTERVAL_MS);
                return () => clearInterval(i);
            }, [fetchData]);

            const summary = useMemo(() => {
                let usVal = 0, usCost = 0, cnVal = 0, cnCost = 0;
                stocks.forEach(s => {
                    if (s.market === 'us') { usVal += s.marketValue; usCost += (s.cost * s.shares); }
                    else { cnVal += s.marketValue; cnCost += (s.cost * s.shares); }
                });
                const totalAsset = CASH_POOL_CNY + cnVal + (usVal * exchangeRate);
                const totalCost = CASH_POOL_CNY + cnCost + (usCost * exchangeRate);
                const totalPL = totalAsset - totalCost;
                
                return {
                    asset: totalAsset, pl: totalPL, plPct: totalCost > 0 ? (totalPL/totalCost)*100 : 0,
                    usVal, usCost, usPL: usVal - usCost, usPct: usCost > 0 ? ((usVal - usCost)/usCost)*100 : 0,
                    cnVal, cnCost, cnPL: cnVal - cnCost, cnPct: cnCost > 0 ? ((cnVal - cnCost)/cnCost)*100 : 0,
                    rate: exchangeRate
                };
            }, [stocks, exchangeRate]);

            return (
                <div className="min-h-screen pb-12 font-sans text-gray-700">
                    <Header onOpenSettings={() => setIsSettingsOpen(true)} onRefresh={() => fetchData(true)} isRefreshing={isRefreshing} marketStatus={marketStatus} />
                    
                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 space-y-6">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                            <SummaryCard 
                                title="总资产净值 (CNY)" isPrimary
                                mainValue={utils.formatCurrency(summary.asset, '¥')}
                                subValue={utils.formatCurrency(summary.asset - summary.pl, '¥')}
                                plValue={summary.pl}
                                plText={`${summary.pl >= 0 ? '+' : ''}${utils.formatCurrency(summary.pl, '¥')} (${utils.formatPercent(summary.plPct)})`}
                                icon={<Icons.Globe className="w-4 h-4" />}
                                extraInfo={<div className="flex w-full justify-between opacity-80"><span>汇率: 1 USD = {summary.rate.toFixed(4)}</span><span>现金: ¥{CASH_POOL_CNY.toLocaleString()}</span></div>}
                            />
                            <SummaryCard 
                                title="美股持仓 (USD)"
                                mainValue={utils.formatCurrency(summary.usVal, '$')}
                                subValue={utils.formatCurrency(summary.usCost, '$')}
                                plValue={summary.usPL}
                                plText={`${summary.usPL >= 0 ? '+' : ''}${utils.formatCurrency(summary.usPL, '$')} (${utils.formatPercent(summary.usPct)})`}
                                icon={<Icons.DollarSign className="w-4 h-4" />}
                            />
                            <SummaryCard 
                                title="A股持仓 (CNY)"
                                mainValue={utils.formatCurrency(summary.cnVal, '¥')}
                                subValue={utils.formatCurrency(summary.cnCost, '¥')}
                                plValue={summary.cnPL}
                                plText={`${summary.cnPL >= 0 ? '+' : ''}${utils.formatCurrency(summary.cnPL, '¥')} (${utils.formatPercent(summary.cnPct)})`}
                                icon={<Icons.TrendingUp className="w-4 h-4" />}
                            />
                        </div>

                        <div className="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
                            <div className="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50">
                                <h3 className="font-bold text-gray-800 flex items-center gap-2"><Icons.Activity className="w-4 h-4 text-gray-500" /> 持仓明细</h3>
                                <div className="text-xs text-gray-400 font-mono">{lastUpdated.toLocaleTimeString('zh-CN', {hour12: false})}</div>
                            </div>
                            <div className="overflow-x-auto scrollbar-hide">
                                <table className="w-full text-sm text-left whitespace-nowrap">
                                    <thead className="text-xs text-gray-500 uppercase bg-gray-50 border-b border-gray-100">
                                        <tr>
                                            <th className="px-6 py-4 font-medium">标的</th>
                                            <th className="px-6 py-4 text-right font-medium hidden sm:table-cell">持仓</th>
                                            <th className="px-6 py-4 text-right font-medium hidden sm:table-cell">成本</th>
                                            <th className="px-6 py-4 text-right font-medium">现价</th>
                                            <th className="px-6 py-4 text-right font-medium">市值</th>
                                            <th className="px-6 py-4 text-right font-medium">盈亏</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-100">
                                        {stocks.map(stock => {
                                            const currency = stock.market === 'us' ? '$' : '¥';
                                            const trendClass = utils.getTrendClass(stock.pl, 'text');
                                            return (
                                                <tr key={stock.code} className="hover:bg-gray-50/80 transition-colors">
                                                    <td className="px-6 py-4">
                                                        <div className="font-bold text-gray-900">{stock.name}</div>
                                                        <div className="text-xs text-gray-400 font-mono mt-0.5">{stock.code}</div>
                                                    </td>
                                                    <td className="px-6 py-4 text-right font-mono text-gray-600 hidden sm:table-cell">{stock.shares}</td>
                                                    <td className="px-6 py-4 text-right font-mono text-gray-500 hidden sm:table-cell">{stock.cost.toFixed(3)}</td>
                                                    <td className={`px-6 py-4 text-right font-mono font-bold ${trendClass}`}>{stock.currentPrice.toFixed(2)}</td>
                                                    <td className="px-6 py-4 text-right font-mono font-medium text-gray-900">{currency}{stock.marketValue.toFixed(2)}</td>
                                                    <td className={`px-6 py-4 text-right font-mono ${trendClass}`}>
                                                        <div className="font-bold">{stock.pl > 0 ? '+' : ''}{stock.pl.toFixed(2)}</div>
                                                        <div className="text-xs opacity-70">({stock.pl > 0 ? '+' : ''}{stock.plPercent.toFixed(2)}%)</div>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </main>

                    <SettingsModal isOpen={isSettingsOpen} onClose={() => setIsSettingsOpen(false)} currentKey={finnhubKey} onSave={(k) => { setFinnhubKey(k); localStorage.setItem('finnhubKey', k); setTimeout(() => fetchData(true), 100); }} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>